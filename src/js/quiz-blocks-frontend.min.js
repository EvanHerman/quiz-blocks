!function(t){const i={addNames:function(){t("form#quiz-blocks-quiz .question").each((function(i){const s=`question-${i}`;t(this).find(".answers .answer").each((function(e){const n=`${s}-answer-${e}`;t(this).find('input[type="radio"]').attr("id",n).attr("name",`question-${i}`),t(this).find("label").attr("for",n)}))}))},notLoggedIn:function(){t("#quiz-blocks-quiz.not-logged-in").find("input").attr("disabled","disabled")},multipleSubmissionsDisabled:function(){t("#quiz-blocks-quiz.multiple-submissions-disabled").find("input").attr("disabled","disabled")},addPopAnimation:function(i){const s=t(i.target);s.prev().prop("disabled")||(s.attr("data-animation","pop"),setTimeout((()=>{s.removeAttr("data-animation")}),200))},disableForm:function(t){t.find("input").attr("disabled",!0)},enableForm:function(t){t.find("input").removeAttr("disabled")},submitQuiz:function(s){s.preventDefault();const n=t(s.target);if(n.hasClass("not-logged-in")||n.hasClass("multiple-submissions-disabled"))return!1;const o=n.serialize(),r=n.data("quizid");u.stop(),i.disableForm(n),jQuery.post(quizBlocks.ajaxURL,{action:"validate_answers",quizID:r,answers:o,timeTaken:a},(function(t){if(t.success){const s=t.data.response;return i.markCorrectAnswers(n,s),e.show(r,s),n.before(`<div class="quiz-blocks-alert success">${quizBlocks.successText}</div>`),void n.find(".show-results").show()}console.error(t),n.before(`<div class="quiz-blocks-alert error">${quizBlocks.errorText}</div>`)}))},markCorrectAnswers:function(t,i){if(!i.show_answers)return;const s=i.results;for(let i=0;i<s.length;i++){const e=i+1;t.find(".question:nth-child("+e+") .answers").addClass(s[i])}}},s=function(i){const s=t(i.target).data("quizid");return jQuery.get(quizBlocks.ajaxURL,{action:"get_rankings",quizID:s},(function(i){i.success?t(`.quiz-${s}-rankings`).html(i.data.rankings):console.error(i)})),t(`.quiz-${s}-rankings`).modal({fadeDuration:150}),!1},e={show:function(i,s){if(!s.show_results)return;const e=(s.counts.correct??0)/s.results.length*100+"%";t(`.quiz-${i}-results`).find(".percent-correct").text(e),t(`.quiz-${i}-results`).find(".number-correct").text(s.counts.correct??0),t(`.quiz-${i}-results`).modal({fadeDuration:150}),t(`button[data-quizid="${i}"].show-results`).show(),n.start()},showExisting:function(i){i.preventDefault();const s=t(i.target).data("quizid");jQuery.get(quizBlocks.ajaxURL,{action:"get_existing_result",quizID:s},(function(i){if(i.success)return t(`.quiz-${s}-results`).find(".percent-correct").text(i.data.results.percent),t(`.quiz-${s}-results`).find(".number-correct").text(i.data.results.counts.correct??0),t(`.quiz-${s}-results`).modal({fadeDuration:150}),void n.start();console.error(i)}))}},n={start:function(){const t=Date.now()+2e3;!function i(){window.confetti({particleCount:5,angle:60,spread:100,origin:{x:0},disableForReducedMotion:!0}),window.confetti({particleCount:5,angle:120,spread:100,origin:{x:1},disableForReducedMotion:!0}),Date.now()<t&&requestAnimationFrame(i)}()}};let o=0,r=0,a=0;const u={start:function(){0===o&&(o=(new Date).getTime())},stop:function(){r=(new Date).getTime(),a=r-o}};t(document).ready(i.addNames),t(document).ready(i.notLoggedIn),t(document).ready(i.multipleSubmissionsDisabled),t("form#quiz-blocks-quiz label").on("click",i.addPopAnimation),t("form#quiz-blocks-quiz label").one("click",u.start),t("form#quiz-blocks-quiz").on("submit",i.submitQuiz),t("button.show-rankings").on("click",s),t("a.show-existing-results").on("click",e.showExisting),t("button.show-results").on("click",(function(i){const s=t(i.target).data("quizid");t(`.quiz-${s}-results`).modal({fadeDuration:150}),n.start()}))}(jQuery);
